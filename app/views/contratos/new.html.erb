<%= form_with(model: [@user, @contrato], local: true) do |form| %>
  <div class="container mt-4">
    <h2>Detalles del Contrato</h2>
    <hr>

    <!-- Sección de Selección de Usuario -->
    <div class="mb-4">
      <h4>Usuario</h4>
      <div class="row">
        <div class="col-md-6">
          <div class="field">
            <%= form.label :user_id, "Seleccionar Cliente" %>
            <%= form.collection_select :user_id, @users, :id, :full_name, { prompt: "Selecciona un cliente" }, { class: "form-control select2" } %>
          </div>
        </div>
      </div>
    </div>

    <!-- Sección de Información Básica -->
    <div class="mb-4">
      <h4>Información Básica</h4>
      <div class="row">
        <div class="col-md-6">
          <div class="form-group">
            <%= form.label :campo, "Campo" %>
            <%= form.text_field :campo, class: "form-control" %>
          </div>
        </div>
        <div class="col-md-6">
          <div class="form-group">
            <%= form.label :capitalizador, "Capitalizador" %>
            <%= form.text_field :capitalizador, class: "form-control" %>
          </div>
        </div>
        <div class="col-md-6">
          <div class="form-group">
            <%= form.label :capitalista, "Capitalista" %>
            <select id="capitalista_field" name="contrato[capitalista][]" multiple="multiple" class="form-control select2">
              <option value="Fideicomiso Financiero Invernea Ganadero, CUIT: 30-71572082-1, Domicilio: San Martin 491 piso 3 of. 8, CABA">
                FFIG
              </option>
              <option value="Invernea Proteina Pyme Serie 1 F.F., CUIT: 30-71733535-6, Domicilio: San Martin 491 piso 3 of. 8, CABA">
                IPS1
              </option>
              <option value="Invernea Proteina Pyme Serie 2 F.F., CUIT: 30-71769311-2, Domicilio: San Martin 491 piso 3 of. 8, CABA">
                IPS2
              </option>
              <option value="Invernea Proteina Pyme Serie 3 F.F., CUIT: 30-71817747-9, Domicilio: San Martin 491 piso 3 of. 8, CABA">
                IPS3
              </option>
              <option value="Invernea Proteina Pyme Serie 4 F.F., CUIT: 30-71848863-6, Domicilio: San Martin 491 piso 3 of. 8, CABA">
                IPS4
              </option>
              <option value="Otro">Otro</option>
            </select>
          </div>
      </div>
    </div>

    <!-- Sección de Vigencia -->
    <div class="mb-4">
      <h4>Vigencia</h4>
      <div class="row">
        <div class="col-md-6">
          <div class="form-group">
            <%= form.label :vigencia_inicio, "Inicio de Vigencia" %>
            <%= form.date_field :vigencia_inicio, class: "form-control" %>
          </div>
        </div>
        <div class="col-md-6">
          <div class="form-group">
            <%= form.label :vigencia_fin, "Fin de Vigencia" %>
            <%= form.date_field :vigencia_fin, class: "form-control" %>
          </div>
        </div>
        <div class="col-md-6">
          <div class="form-group">
            <%= form.label :prorroga, "Prórroga" %>
            <%= form.check_box :prorroga, class: "form-check-input" %>
          </div>
        </div>
      </div>
    </div>

    <!-- Sección de Obligaciones -->
    <div class="mb-4">
      <h4>Obligaciones</h4>
      <div class="row">
        <div class="col-md-6">
          <div class="form-group">
            <%= form.label :obligaciones_capitalizador, "Obligaciones del Capitalizador" %>
            <%= form.text_area :obligaciones_capitalizador, class: "form-control" %>
          </div>
        </div>
        <div class="col-md-6">
          <div class="form-group">
            <%= form.label :obligaciones_capitalista, "Obligaciones del Capitalista" %>
            <%= form.text_area :obligaciones_capitalista, class: "form-control" %>
          </div>
        </div>
      </div>
    </div>

    <!-- Sección de Condiciones Técnicas -->
    <div class="mb-4">
      <h4>Condiciones Técnicas</h4>
      <div class="row">
        <div class="col-md-4">
          <div class="form-group">
            <%= form.label :mortandad_tolerada, "Mortandad Tolerada (%)" %>
            <%= form.number_field :mortandad_tolerada, step: 0.1, class: "form-control" %>
          </div>
        </div>
        <div class="col-md-4">
          <div class="form-group">
            <%= form.label :mortandad_excedida, "Mortandad Excedida (%)" %>
            <%= form.number_field :mortandad_excedida, step: 0.1, class: "form-control" %>
          </div>
        </div>
        <div class="col-md-4">
          <div class="form-group">
            <%= form.label :encierre, "Encierre Permitido" %>
            <%= form.check_box :encierre, class: "form-check-input" %>
          </div>
        </div>
      </div>
    </div>

    <!-- Sección de Pesaje -->
    <div class="mb-4">
      <h4>Pesaje y Control</h4>
      <div class="row">
        <div class="col-md-4">
          <div class="form-group">
            <%= form.label :frecuencia_pesaje, "Frecuencia de Pesaje" %>
            <%= form.select :frecuencia_pesaje, options_for_select([["Bimestral", "bimestral"], ["Mensual", "mensual"], ["Semanal", "semanal"]], selected: @contrato.frecuencia_pesaje), { class: "form-control select2" } %>
          </div>
        </div>
        <div class="col-md-4">
          <div class="form-group">
            <%= form.label :porcentaje_pesaje, "Porcentaje de Pesaje (%)" %>
            <%= form.number_field :porcentaje_pesaje, step: 0.1, class: "form-control" %>
          </div>
        </div>
        <div class="col-md-4">
          <div class="form-group">
            <%= form.label :desbaste, "Desbaste Estimado (%)" %>
            <%= form.number_field :desbaste, step: 0.1, class: "form-control" %>
          </div>
        </div>
      </div>
    </div>

    <!-- Sección de Condiciones Comerciales -->
    <div class="mb-4">
      <h4>Condiciones Comerciales</h4>
      <div class="row">
        <div class="col-md-4">
          <div class="form-group">
            <%= form.label :gdpv, "Ganancia Diaria de Peso Vivo (gramos)" %>
            <%= form.number_field :gdpv, class: "form-control" %>
          </div>
        </div>
        <div class="col-md-4">
          <div class="form-group">
            <%= form.label :porcentaje_capitalizador, "Porcentaje para el Capitalizador (%)" %>
            <%= form.number_field :porcentaje_capitalizador, step: 0.1, class: "form-control" %>
          </div>
        </div>
        <div class="col-md-4">
          <div class="form-group">
            <%= form.label :forma_cancelacion, "Forma de Cancelación" %>
            <%= form.text_field :forma_cancelacion, class: "form-control" %>
          </div>
        </div>
      </div>
    </div>

    <!-- Botón de envío -->
    <div class="actions text-center mt-4">
      <%= form.submit "Guardar Contrato", class: "btn btn-primary" %>
    </div>
  </div>
<% end %>


<script>
  $(document).ready(function() {
    // Inicializa Select2 en el campo de usuario
    $('#user_id_field').select2({
      placeholder: "Selecciona un cliente",
      allowClear: true,
      width: '100%'
    });

    // Inicializa Select2 en el campo de capitalista con selección múltiple
    $('#capitalista_field').select2({
      placeholder: "Selecciona una o más opciones",
      allowClear: true,
      width: '100%'
    });
  });
</script>
